<!DOCTYPE html>
<html lang='en' xmlns='http://www.w3.org/1999/html'>

<head>
    <meta charset='UTF-8'>
    <title>Edit Profile</title>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
    <link href='Bootstrap/css/bootstrap.min.css' rel='stylesheet'>
    <link href='bootstrap-icons-1.8.1/bootstrap-icons.css' rel='stylesheet'>

    <script src='js/jquery-3.5.1.min.js'></script>
    <script src='js/jquery.cookie.js'></script>
    <script src='js/jquery.session.js'></script>
    <script src='js/jquery-deparam.min.js'></script>
    <script src='Bootstrap/js/bootstrap.min.js'></script>
    <script src='js/moment.js'></script>
    <script src='tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.js'></script>
    <link href='tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.css' rel='stylesheet'>
    <script>
        $(function () {
            $('#datetimepicker').datetimepicker();
            console.log($('#Birthday'));
            let user_info = $.deparam(decodeURIComponent($.cookie('userInfo')));
            console.info(user_info);
            $('#userMenuButton').html(user_info.User.firstName+user_info.User.lastName);
            $('#first_name').val(user_info.User.firstName);
            $('#last_name').val(user_info.User.lastName);
            $('#email').val(user_info.User.email);
            $('#birthday').val('2000-05-06');
            if (user_info.User.enrolledForPromotions === '') {
                $('#enrolledForPromotions').attr('checked', false);
            }
            else {
                $('#enrolledForPromotions').attr('checked', true);
            }

            let date = new Date();
            let year = date.getFullYear();
            let month = (date.getMonth() + 1).toString().padStart(2, '0');
            $('#expiration_date').attr('min', year + '-' + month);

            let card_display = $('#display_cards');
            for (let i = 1; i <= 2; i++) {
                let cardi = $('<div class="row"></div>').attr('id', 'card' + i);
                let cardinfo_i = $('<div class="col-3 mt-5"></div>').append(
                    $('<div class="card"></div>').append(
                        $('<div class="card-header"></div>').html(`Visa<br>•••• ${user_info.PaymentCard.cardno}`)
                    ),
                );
                let cardform_i = $('<form class="col-9"></form>').attr('id', 'card_form' + i).append(
                    $('<div class="form-group"></div>').append(
                        $('<label></label>').attr('for', 'Address' + i).html('Address'),
                        $('<input class="form-control" name="billingaddress">').attr('id', 'Address' + i),
                    ),
                    $('<div class="row"></div>').append(
                        $('<div class="col-4"></div>').append(
                            $('<label></label>').attr('for', 'city' + i).html('City'),
                            $('<input class="form-control" name="city">').attr('id', 'city' + i),
                        ),
                        $('<div class="col-4"></div>').append(
                            $('<label></label>').attr('for', 'state' + i).html('State'),
                            $('<input class="form-control" name="state">').attr('id', 'state' + i),
                        ),
                        $('<div class="col-4"></div>').append(
                            $('<label></label>').attr('for', 'zipcode' + i).html('Zip Code'),
                            $('<input class="form-control" name="zipcode">').attr('id', 'zipcode' + i),
                        ),
                    ),
                );
                let button_i = $('<div class="container row mt-4"></div>').append(
                    $('<a class="btn btn-danger offset-2 col-3" href="#" type="button"></a>').attr('id', 'delete_card_btn' + i).html('Delete'),
                    $('<a class="btn btn-warning offset-2 col-3" href="#" type="button"></a>').attr('id', 'change_card_btn' + i).html('Change Billing Address'),
                );
                cardi.append(cardinfo_i, cardform_i, button_i);
                card_display.append(cardi, $('<div class="dropdown-divider"></div>'));
            }

            $('#add_card_close').click(() => {
                $('#card_number').val('');
                $('#expiration_date').val('');
                $('#security_number').val('');
            })

            $('#add_card_submit').click(() => {
                if ($('#card_number').val() === '' || $('#expiration_date').val() === '' || $('#security_number').val() === '') {
                    alert('please input the full information');
                }
                else {
                    $.ajax({
                        type: 'post',
                        url: '',//need change
                        contentType: false,
                        processData: false,
                        data: new FormData($('#add_card_form')[0]),
                        success: (data) => {
                            if (data.Status === 1) {
                                alert('add card successful');
                                $('#add_card_close').click();
                                //todo
                                //update card display again
                            }
                            else {
                                alert(data.Description);
                            }
                        }
                    });
                }
            })
        })
    </script>
</head>

<body>
<div class='container-fluid'>
    <nav class='row navbar fixed-top navbar-expand-lg navbar-dark' style='background-color: #000000;'>
        <a class=' col-2 navbar-brand' href='index.html'>
            <img src='image/UGA.png' style='width: 4vh;height: 4vh;' class='d-inline-block align-top'> CSCI 6050 Movie
            Booking
        </a>
        <div class='col-2 offset-3 '>
            <p class='h2' style='color: white'>Edit Profile</p>
        </div>
        <div class='offset-3 col-2'>
            <div class='dropdown'>
                <button class='btn btn-secondary dropdown-toggle' type='button' id='userMenuButton' data-toggle='dropdown' aria-expanded='false'>
                </button>
                <div class='dropdown-menu' aria-labelledby='userMenuButton'>
                    <a class='dropdown-item' href='#'>Order</a>
                    <a class='dropdown-item' href='#'>Edit Profile</a>
                    <a class='dropdown-item' href='index.html'>Log out</a>
                </div>
            </div>
        </div>
    </nav>
</div>
<div class='container' style='margin-top: 100px;min-height: 70vh'>
    <div>
        <div class='text-center h1'>Personal Information</div>
        <div>
            <form>
                <div class='row'>
                    <div class='form-group col-6'>
                        <label for='first_name'>First Name</label>
                        <input type='text' class='form-control' id='first_name' name='firstName'
                               placeholder='First name'>
                    </div>
                    <div class='form-group col-6'>
                        <label for='last_name'>Last Name</label>
                        <input type='text' class='form-control' id='last_name' name='lastName' placeholder='Last name'>
                    </div>
                </div>
                <div class='form-group'>
                    <label for='email'>Email</label>
                    <input type='text' class='form-control' id='email' name='email' placeholder='Email' disabled>
                </div>
                <div class='form-group'>
                    <label for='birthday'>Birthday</label>
                    <input type='date' class='form-control' id='birthday' disabled>
                </div>
            </form>
        </div>
        <div class='text-center'>
            <a href='#' type='button' class='btn btn-warning'>Change Password</a>
        </div>
    </div>
    <div class='dropdown-divider'></div>
    <div>
        <div class='text-center h1'>Payment Information</div>
        <div id='display_cards'>
            <!--            <div id='card1' class='row'>-->
            <!--                <div class='col-3 mt-5'>-->
            <!--                    <div class='card'>-->
            <!--                        <div class='card-header'>-->
            <!--                            Visa<br>•••• 7324-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--                <form id='card_form1' class='col-9'>-->
            <!--                    <div class='form-group'>-->
            <!--                        <label for='Address1'>Address</label>-->
            <!--                        <input type='text' class='form-control' id='Address1' name='billingaddress'>-->
            <!--                    </div>-->
            <!--                    <div class='row'>-->
            <!--                        <div class='col-4'>-->
            <!--                            <label for='city1'>City</label>-->
            <!--                            <input type='text' class='form-control' id='city1' name='city'>-->
            <!--                        </div>-->
            <!--                        <div class='col-4'>-->
            <!--                            <label for='state1'>Country</label>-->
            <!--                            <input type='text' class='form-control' id='state1' name='state'>-->
            <!--                        </div>-->
            <!--                        <div class='col-4'>-->
            <!--                            <label for='zipcode1'>Zip Code</label>-->
            <!--                            <input type='text' class='form-control' id='zipcode1' name='zipcode'>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </form>-->
            <!--                <div class='container row mt-4'>-->
            <!--                    <a href='#' type='button' class='btn btn-danger offset-2 col-3'>Delete</a>-->
            <!--                    <a href='#' type='button' class='btn btn-warning offset-2 col-3'>Change Billing Address</a>-->
            <!--                </div>-->
            <!--            </div>-->
            <!--            <div class='dropdown-divider'></div>-->
            <!--            <div id='card2' class='row'>-->
            <!--                <div class='col-3 mt-4'>-->
            <!--                    <div class='card'>-->
            <!--                        <div class='card-header btn text-left'>-->
            <!--                            xxxxBank <br/> ......5678-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--                <form class='col-9'>-->
            <!--                    <div class='form-group'>-->
            <!--                        <label for='Address2'>Address</label>-->
            <!--                        <input type='text' class='form-control' id='Address2' name='Address'>-->
            <!--                    </div>-->
            <!--                    <div class='row'>-->
            <!--                        <div class='col-5'>-->
            <!--                            <label for='city'>City</label>-->
            <!--                            <input type='text' class='form-control' id='city' name='city'>-->
            <!--                        </div>-->
            <!--                        <div class='col-3'>-->
            <!--                            <label for='state'>Country</label>-->
            <!--                            <input type='text' class='form-control' id='state' name='state'>-->
            <!--                        </div>-->
            <!--                        <div class='col-4'>-->
            <!--                            <label for='Zipcode'>Zip Code</label>-->
            <!--                            <input type='text' class='form-control' id='Zipcode' name='Zipcode'>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </form>-->
            <!--                <div class='container row  mt-4'>-->
            <!--                    <a href='#' type='button' class='btn btn-danger offset-2 col-3'>Delete</a>-->
            <!--                    <a href='#' type='button' class='btn btn-warning offset-2 col-3'>Change Billing Address</a>-->
            <!--                </div>-->
            <!--            </div>-->
        </div>

        <div class='col-2 offset-5 my-4'>
            <button id='add_card_button' class='col-12 btn badge-primary text-center' data-toggle='modal'
                    data-target='#staticBackdrop'>Add card
            </button>
        </div>


        <div class='modal fade' id='staticBackdrop' data-backdrop='static' data-keyboard='false' tabindex='-1'
             aria-labelledby='staticBackdropLabel' aria-hidden='true'>
            <div class='modal-dialog modal-dialog-centered'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <h5 class='modal-title' id='staticBackdropLabel'>Modal title</h5>
                        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
                            <span aria-hidden='true'>&times;</span>
                        </button>
                    </div>
                    <div class='modal-body'>
                        <form id='add_card_form'>
                            <div class='form-group'>
                                <label for='card_number'>Card Number</label>
                                <input type='text' class='form-control' id='card_number' name='cardno'>
                            </div>
                            <div class='form-group'>
                                <label for='expiration_date'>Expiry Date</label>
                                <input type='month' class='form-control' id='expiration_date' name='expirationdate'>
                            </div>
                            <div class='form-group'>
                                <label for='security_number'>Security Number</label>
                                <input type='text' class='form-control' id='security_number' name='security_number'>
                            </div>
                        </form>
                    </div>
                    <div class='modal-footer'>
                        <button type='button' id='add_card_close' class='btn btn-secondary' data-dismiss='modal'>Close
                        </button>
                        <button type='button' id='add_card_submit' class='btn btn-primary' data-dismiss='modal'>Submit
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='dropdown-divider '></div>
    <div class='mt-4'>
        <div class='text-center h1'>Opt-in for promotion Email</div>
        <div class='row mt-4'>
            <div class='form-check offset-2 col-1' style='width: 5px'>
                <input class='form-check-input input-group-lg' type='checkbox' name='enrolledForPromotions'
                       id='enrolledForPromotions'>
            </div>
            <div class='col-8'>
                <p>By checking this box, I confirmed and agreed that the CSCI 6050 Cinema E-booking System shall send
                    their latest promotion and released movie promotion to my personal email.</p>
            </div>
        </div>
    </div>
    <div class='dropdown-divider '></div>
    <div class='mx-auto px-auto'>
        <a href='index_login.html' type='button' class='col-2 offset-5 btn btn-success '>Submit</a>
    </div>
</div>

<div id='footer' class='container-fluid ' style='background: black; color: white; margin-top: 50px;padding: 40px'>
    <div class='container'>
        <div class='row text-center'>
            <div class='col-4'>
                <a>Conditions of Use</a>
            </div>
            <div class='col-4'>
                <a>Privacy & Policy</a>
            </div>
            <div class='col-4'>
                <a>Press Room</a>
            </div>
        </div>
        <div class='row copyright-bottom text-center'>
            <div class=' col-12 text-center'>
                <p>© 2022 Cinema E-Booking by CSCI 6050 Team B6</p>
            </div>
        </div>
    </div>
</div>
</body>
</html>