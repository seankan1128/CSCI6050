<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Set New Password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../Bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../bootstrap-icons-1.8.1/bootstrap-icons.css" rel="stylesheet">
    <link href="../css/register.css" rel="stylesheet">
    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src="../Bootstrap/js/bootstrap.min.js"></script>
    <script src="../js/jquery.session.js"></script>
    <script src="../js/jquery.cookie.js"></script>
    <script src="../js/jquery-deparam.min.js"></script>
    <script>
        $(function () {
            $('#submit_button').click(() => {
                var arr = $('#passwordform').serializeArray();
                var input1 = arr[0].value;
                var input2 = arr[1].value;


                // let data1 = new FormData();
                // let user_info = undefined;
                // if ($.session.get('userInfo') != undefined) {
                //     user_info = $.deparam(decodeURIComponent($.session.get('userInfo')));
                // }
                // else {
                //     user_info = $.deparam(decodeURIComponent($.cookie('userInfo')));
                // }
                // let email = user_info.User.email;
                // //let email = $.session.get('email') || $.cookie('email');//change
                // let newpassword = $('#newpassword')[0];
                // data1.append('newpassword', newpassword);
                // data1.append('email', email);
                //
                if (input1 === input2) {
                    $.ajax({
                        type: "post",
                        url: "forgetpw/verify2",
                        contentType: false,
                        processData: false,
                        data: new FormData($('#passwordform')[0]),
                        success: (data) => {
                            if (data.ReturnStatus.status === 1) {
                                console.log(data);
                                location.href = "change_password_finish";
                            }
                            else {
                                alert(data.ReturnStatus.description);
                            }
                        },
                        error: () => {
                            alert("error message");
                        },
                    });
                }
                else {
                    alert("password is not the same")
                    $("#newpassword").val("");
                    $("#confirmpassword").val("");
                }
            })
        });
    </script>
</head>

<body>
<div class="container-fluid">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark" style="background-color: #000000;">
        <a class="navbar-brand col-2" href="index.html">
            <img src="../image/UGA.png" width="30" height="30" class="d-inline-block align-top" alt=""> CSCI 6050 Movie
            Booking
        </a>
    </nav>
</div>
<div class="container " style="margin-top: 250px">
    <div class="row">
        <div class="offset-3 col-6">
            <form class="form-horizontal" id="passwordform">
                <span class="heading">Set New Password</span>
                <div class="form-group help">
                    <input type="password" class="form-control" id="newpassword" name="newpassword" placeholder="Password">
                    <i class="bi bi-shield-lock-fill"></i>
                    <a href="#" class="fa fa-question-circle"></a>
                </div>
                <div class="form-group help">
                    <input type="password" class="form-control" id="confirmpassword" name="confirmpassword" placeholder="Password Again">
                    <i class="bi bi-shield-lock-fill"></i>
                    <a href="#" class="fa fa-question-circle"></a>
                </div>
                <div class="form-group offset-5 col-8">
                    <a type="submit" id="submit_button" class="btn btn-warning">Submit</a>
                </div>
            </form>
        </div>
    </div>
</div>
</body>

</html>